<!-- Sidebar de chats -->
<div *ngIf="friends.length">
  <ul class="list-group">
    <li *ngFor="let f of friends" class="list-group-item" (click)="openChat(f)"
      [class.active]="selectedChat?.uid === f.uid">
      {{ f.username }}
    </li>
  </ul>
</div>

<!-- Ventana de chat -->
<div *ngIf="selectedChat" class="chat-window card shadow"
  style="position: fixed; bottom:1rem; right:1rem; width:300px; z-index:1050;">
  <div class="card-header d-flex justify-content-between">
    <span>Chat con {{ selectedChat.username }}</span>
    <button class="btn-close" (click)="closeChat()"></button>
  </div>

  <div class="card-body p-2" style="height:200px; overflow-y:auto;">
    <div *ngFor="let m of chatConversations[ getChatIdByUsername(currentUsername, selectedChat.username) ]">
      <div [ngClass]="{
              'd-flex justify-content-end': m.sender === 'me',
              'd-flex justify-content-start': m.sender === 'them'
            }">
        <div class="p-1 mb-1" [ngStyle]="{
                'background-color': m.sender==='me'?'#DCF8C6':'#F1F0F0',
                'border-radius':'8px',
                'max-width':'80%'
              }">
          {{ m.text }}
        </div>
      </div>
    </div>
  </div>

  <div class="card-footer p-2">
    <div class="input-group input-group-sm">
      <input class="form-control" [(ngModel)]="newMessageText" (keyup.enter)="sendMessage()" placeholder="Escribeâ€¦" />
      <button class="btn btn-primary" (click)="sendMessage()">Enviar</button>
    </div>
  </div>
</div>