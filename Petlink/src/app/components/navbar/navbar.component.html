<nav class="navbar navbar-expand-lg" [ngClass]="{'bg-white': !showNotifications, 'bg-success': showNotifications}"
  style="padding: .5rem 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
  <div class="container-fluid">
    <!-- Logo -->
    <button type="button" class="navbar-brand p-0 bg-transparent border-0" (click)="openHome()">
      <img src="/assets/images/petlink_logo.svg" alt="PetLink Logo" height="40" />
    </button>

    <!-- Search -->
    <div class="mx-auto w-50">
      <div class="input-group">
        <input type="text" class="form-control border-start-0 rounded-end" [(ngModel)]="query" placeholder="Buscar..." />
        <ul *ngIf="results.length">
          <li *ngFor="let u of results">
            <a [routerLink]="['/profile', u.uid]">
              <img [src]="u.avatar" width="24" height="24"> {{ u.username }}
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Icons -->
    <ul class="navbar-nav flex-row align-items-center">
      <!-- Campana de notificaciones -->
      <li class="nav-item position-relative me-3">
        <button class="btn nav-link p-0" (click)="toggleNotifications($event)">
          <i class="fas fa-bell fa-lg"></i>
          <span *ngIf="unreadCount"
            class="badge bg-danger rounded-pill position-absolute top-0 start-100 translate-middle">
            {{ unreadCount }}
          </span>
        </button>

        <!-- floater absoluto -->
        <div *ngIf="showNotifications" class="card shadow p-0 d-flex flex-column notification-menu"
          style="width: 300px; max-height: 240px;">
          <div class="card-header flex-shrink-0 fw-bold">
            Notificaciones
          </div>

          <div class="list-group list-group-flush flex-grow-1 overflow-auto">
            <a *ngFor="let n of notifications" [routerLink]="n.link||null"
              class="list-group-item d-flex align-items-start" [ngClass]="{'unread': !n.read, 'read': n.read}"
              (click)="markAsRead(n, $event)">
              <img [src]="n.avatar" class="rounded-circle me-2" width="30" height="30" />
              <div class="small">
                <strong>{{ n.username }}</strong>
                <div class="text-truncate">{{ n.message }}</div>
              </div>
            </a>
            <div *ngIf="!notifications.length" class="list-group-item text-center text-muted py-3">
              No hay notificaciones
            </div>
          </div>

          <div class="card-footer flex-shrink-0 text-center py-2">
            <a class="list-group-item list-group-item-action m-0" routerLink="/notificaciones">
              Ver todas
            </a>
          </div>
        </div>
      </li>
      <!-- Perfil -->
      <li class="nav-item">
        <a class="nav-link" routerLink="/profilefeed" style="cursor: pointer;">
          <i class="fas fa-user fa-lg"></i>
        </a>
      </li>
      <!-- ConfiguraciÃ³n del perfil -->
      <li class="nav-item">
        <a class="nav-link" (click)="openProfile()" style="cursor: pointer;">
          <i class="fas fa-cog fa-lg"></i>
        </a>
      </li>
    </ul>
  </div>
</nav>